<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Contrata-Dev: Criar Projeto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/stylesheets/request.css" />
  </head>

  <body>
    <header class="topbar">
      <img src="/images/logo.webp" alt="Logo" class="logo" />
    </header>
    <a class="back" href="dashboard">← Voltar</a>
    <main class="container">
      <form id="pedidoForm" action="/api/v1/projects" method="post">
        <div class="field">
          <label for="titulo">Titulo Da Solicitação</label>
          <input
            id="titulo"
            name="title"
            type="text"
            required
            maxlength="100"
          />
        </div>

        <div class="field">
          <label for="budget">Recompensa</label>
          <input
            id="budget"
            name="budget"
            type="text"
            pattern="\d{1,}"
            maxlength="100"
          />
        </div>

        <div class="field">
          <label for="descricao">Descrição</label>
          <textarea
            id="descricao"
            name="description"
            rows="4"
            maxlength="200"
            placeholder="máximo de caracteres(200)"
          ></textarea>
          <div class="hint"><span id="count">0</span>/200</div>
        </div>

        <div class="field">
          <label for="tech-select">Tecnologias que serão usadas</label>
          <div class="select-wrapper">
            <select id="tech-select">
              <option value="" disabled selected>escolha pelo menos uma</option>
              <%
              (['JavaScript','Node.js','React','TypeScript','Python','PostgreSQL']).forEach(function(tec){
              %>
              <option value="<%= tec %>"><%= tec %></option>
              <% }) %>
            </select>
            <span class="chevron">▾</span>
          </div>
          <!-- Campo real enviado no POST (CSV) -->
          <input type="hidden" name="tecnologias" id="tecnologiasHidden" />
        </div>

        <div class="field">
          <label>Tecnologias já selecionadas</label>
          <div id="chips" class="chips"></div>
        </div>

        <div class="actions">
          <button type="submit" class="primary">
            Publicar <span class="arrow">→</span>
          </button>
        </div>
      </form>
    </main>

    <script>
      (function () {
        const textarea = document.getElementById("descricao");
        const count = document.getElementById("count");
        const select = document.getElementById("tech-select");
        const chips = document.getElementById("chips");
        const hidden = document.getElementById("tecnologiasHidden");

        // contador de caracteres
        if (textarea && count) {
          const update = () => (count.textContent = textarea.value.length);
          textarea.addEventListener("input", update);
          update();
        }

        // estado local das tecnologias selecionadas
        const current = new Set(
          (hidden.value ? hidden.value.split(",") : []).filter(Boolean)
        );

        // render chips e sincroniza hidden
        const render = () => {
          chips.innerHTML = "";
          current.forEach((v) => {
            const el = document.createElement("span");
            el.className = "chip";
            el.dataset.val = v;
            el.innerHTML =
              v +
              '<button type="button" class="remove" aria-label="remover">×</button>';
            chips.appendChild(el);
          });
          hidden.value = Array.from(current).join(",");
        };

        // adiciona tecnologia
        if (select) {
          select.addEventListener("change", (e) => {
            const val = e.target.value;
            if (val) current.add(val);
            render();
            select.selectedIndex = 0; // volta para placeholder
          });
        }

        // remove chip
        chips.addEventListener("click", (e) => {
          const btn = e.target.closest(".remove");
          if (btn) {
            current.delete(btn.parentElement.dataset.val);
            render();
          }
        });

        // validação no submit
        document
          .getElementById("pedidoForm")
          .addEventListener("submit", (e) => {
            if (current.size === 0) {
              e.preventDefault();
              alert("Escolha pelo menos uma tecnologia.");
            }
          });

        render();
      })();
    </script>
  </body>
</html>
